#!/bin/bash /etc/rc.common

START=21
USE_PROCD=1
DEBUG=1

. /usr/lib/bakesale/bakesale.sh

handle_error() {
	log error "$1"
	[ "$DEBUG" -ne 1 ] && {
		cleanup_files
		nft delete table inet bakesale 2>/dev/null
	}
	return 1
}

start_service() {
	setup start && log notice "Service started" || handle_error "Service start failed"
}

reload_service() {
	/etc/init.d/bakesale status &>/dev/null || {
		echo "The bakesale service does not appear to be loaded."
		return 1
	}
	setup reload && log notice "Service reloaded" || handle_error "Service reload failed"
}

stop_service() {
	cleanup_files
	nft delete table inet bakesale 2>/dev/null
	log notice "Service stopped successfully"
}

service_triggers() {
	procd_add_reload_trigger "firewall" "sqm" "bakesale"
}
